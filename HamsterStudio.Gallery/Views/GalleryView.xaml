<UserControl x:Class="HamsterStudio.Gallery.Views.GalleryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:handy="https://handyorg.github.io/handycontrol"
             xmlns:local="clr-namespace:HamsterStudio.Gallery.Views"
             xmlns:localm="clr-namespace:HamsterStudio.Gallery.Models"
             xmlns:localp="clr-namespace:HamsterStudio.Gallery"
             xmlns:localvm="clr-namespace:HamsterStudio.Gallery.ViewModels"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             d:DesignHeight="450"
             d:DesignWidth="800"
             mc:Ignorable="d">
    <UserControl.DataContext>
        <localvm:GalleryViewModel />
    </UserControl.DataContext>

    <DockPanel DataContext="{Binding FileManager}">
        <TextBlock DockPanel.Dock="Top" Text="{Binding FileGroups.Count, StringFormat=共计{0}个分组}" />
        <ComboBox x:Name="cbFileGroups"
                  DockPanel.Dock="Top"
                  IsManipulationEnabled="True"
                  ItemsSource="{Binding FileGroups}"
                  SelectedIndex="0">
            <ComboBox.ContextMenu>
                <ContextMenu>
                    <MenuItem Command="{Binding OpenCommand}" Header="打开文件夹..." />
                </ContextMenu>
            </ComboBox.ContextMenu>
            <ComboBox.ItemTemplate>
                <DataTemplate>
                    <DockPanel>
                        <Image Width="128"
                               Height="128"
                               DockPanel.Dock="Left"
                               Source="{Binding Files[0].FullName}"
                               Stretch="Uniform" />
                        <DockPanel>
                            <TextBlock DockPanel.Dock="Top" Text="{Binding GroupName}" />
                            <TextBlock DockPanel.Dock="Top" Text="{Binding Files.Count, StringFormat=共计{0}个}" />
                        </DockPanel>
                    </DockPanel>
                </DataTemplate>
            </ComboBox.ItemTemplate>
        </ComboBox>
        <DockPanel HorizontalAlignment="Stretch" VerticalAlignment="Stretch" DataContext="{Binding SelectedItem, ElementName=cbFileGroups}">
            <TextBlock Margin="2" DockPanel.Dock="Top" Text="{Binding GroupName}" />
            <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">
                <Button Margin="3" Command="{Binding NextPageCommand}">
                    <Button.Content>
                        <TextBlock>
                            <Run Text="下一页" />
                            <Run Text="{Binding CurrentPageIndex}" />
                            <Run Background="SkyBlue" Text="+1" />
                        </TextBlock>
                    </Button.Content>
                </Button>
                <handy:NumericUpDown handy:InfoElement.Title="PageColumns" Style="{StaticResource NumericUpDownExtend}" Value="{Binding PageColumns}" />
                <handy:NumericUpDown handy:InfoElement.Title="PageRows" Style="{StaticResource NumericUpDownExtend}" Value="{Binding PageRows}" />
            </StackPanel>
            <!--  相册显示区域  -->
            <ItemsControl x:Name="albm" ItemsSource="{Binding CurrentPageView}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="3">
                            <Image MaxWidth="500"
                                   MaxHeight="500"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Loaded="Image_Loaded"
                                   Source="{Binding FullName}"
                                   Stretch="UniformToFill" />
                            <Rectangle Height="15" VerticalAlignment="Bottom" Fill="Black" Opacity="0.35" />
                            <TextBlock VerticalAlignment="Bottom" Foreground="White" Text="{Binding Name}" />
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="{Binding PageColumns}" Rows="{Binding PageRows}" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
        </DockPanel>
    </DockPanel>
</UserControl>
